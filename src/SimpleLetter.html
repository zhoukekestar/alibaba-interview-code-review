<style>
  simple-letter {
    width: 600px;
    margin: 40px auto;
    display: block;
  }

  simple-letter header > time {
    float: right;
  }

  simple-letter footer {
    text-align: right;
  }
</style>

<script>
  class SimpleLetter extends TemplateMustache {
    constructor(rendered = false) {
      super();

      this.DEBUG = false;

      this.from = this.getAttribute('from');
      this.to = this.getAttribute('to');

      this.renderedSymbol = Symbol();
      this.webcomponentsSymbol = Symbol();

      this.rendered = rendered;
    }

    connectedCallback() {
      this.connected = true;
      if (!this.rendered) {
        this.render();
      }
    }

    get rendered() {
      return this[this.renderedSymbol];
    }

    set rendered(v) {
      this[this.renderedSymbol] = v;
    }

    /**
     * letter comes from
     */
    get from() {
      this.DEBUG && console.log('[SimpleLetter] get from()');
      return this.getAttribute('from');
    }

    set from(v) {
      this.DEBUG && console.log(`[SimpleLetter] set from(${v})`);
      this.setAttribute('from', v);
      this.render();
    }

    /**
     * letter is for
     */
    get to() {
      this.DEBUG && console.log('[SimpleLetter] get to()');
      return this.getAttribute('to');
    }

    set to(v) {
      this.DEBUG && console.log(`[SimpleLetter] set to(${v})`);
      this.setAttribute('to', v);
      this.render();
    }

    get webcomponents() {
      return this[this.webcomponentsSymbol];
    }

    set webcomponents(v) {
      this[this.webcomponentsSymbol] = v;
      this.render();
    }

    render() {
      this.DEBUG && console.log(`[SimpleLetter] rendered: ${this.rendered} connected: ${this.connected}`);

      if (!this.connected || this.rendered) return;

      TemplateMustache.prototype.render.call(this, {
        from: this.from,
        to: this.to,
        webcomponents: this.webcomponents,
      });
    }
  }

  customElements.define('simple-letter', SimpleLetter);
</script>
